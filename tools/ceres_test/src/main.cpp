#include "ceres/ceres.h"
#include "glog/logging.h"
#include <vector>
#include <cmath>
using ceres::AutoDiffCostFunction;
using ceres::CostFunction;
using ceres::Problem;
using ceres::Solver;
using ceres::Solve;

const int kNumObservations = 67;

//std::vector<double> data_x1 = {1.436853009734097242e+00,1.436853009734097242e+00,1.436853009734097242e+00,1.436853009734097242e+00,1.436853009734097242e+00,1.436853009734097242e+00,1.436405507711523866e+00,1.436405507711523866e+00,1.436405507711523866e+00,1.436405507711523866e+00,1.436405507711523866e+00,1.436405507711523866e+00,1.435802960071871803e+00,1.435802960071871803e+00,1.435802960071871803e+00,1.435802960071871803e+00,1.435802960071871803e+00,1.435802960071871803e+00,1.435045171513210649e+00,1.435045171513210649e+00,1.435045171513210649e+00,1.435045171513210649e+00,1.435045171513210649e+00,1.435045171513210649e+00,1.434132411215603975e+00,1.434132411215603975e+00,1.434132411215603975e+00,1.434132411215603975e+00,1.434132411215603975e+00,1.434132411215603975e+00,1.433064383061087632e+00,1.433064383061087632e+00,1.433064383061087632e+00,1.433064383061087632e+00,1.433064383061087632e+00,1.433064383061087632e+00,1.431840739600916956e+00,1.431840739600916956e+00,1.431840739600916956e+00,1.431840739600916956e+00,1.431840739600916956e+00,1.431840739600916956e+00,1.430461081486321451e+00,1.430461081486321451e+00,1.430461081486321451e+00,1.430461081486321451e+00,1.430461081486321451e+00,1.430461081486321451e+00,1.428925473954114622e+00,1.428925473954114622e+00,1.428925473954114622e+00,1.428925473954114622e+00,1.428925473954114622e+00,1.428925473954114622e+00,1.427233413631010306e+00,1.427233413631010306e+00,1.427233413631010306e+00,1.427233413631010306e+00,1.427233413631010306e+00,1.427233413631010306e+00,1.425384343346214999e+00,1.425384343346214999e+00,1.425384343346214999e+00,1.425384343346214999e+00,1.425384343346214999e+00,1.425384343346214999e+00,1.423378170356867090e+00,1.423378170356867090e+00,1.423378170356867090e+00,1.423378170356867090e+00,1.423378170356867090e+00,1.423378170356867090e+00,1.421214749318005621e+00,1.421214749318005621e+00,1.421214749318005621e+00,1.421214749318005621e+00,1.421214749318005621e+00,1.421214749318005621e+00,1.418893360950094884e+00,1.418893360950094884e+00,1.418893360950094884e+00,1.418893360950094884e+00,1.418893360950094884e+00,1.418893360950094884e+00,1.416413228565769566e+00,1.416413228565769566e+00,1.416413228565769566e+00,1.416413228565769566e+00,1.416413228565769566e+00,1.416413228565769566e+00,1.413774039414001926e+00,1.413774039414001926e+00,1.413774039414001926e+00,1.413774039414001926e+00,1.413774039414001926e+00,1.413774039414001926e+00,1.410975424683673429e+00,1.410975424683673429e+00,1.410975424683673429e+00,1.410975424683673429e+00,1.410975424683673429e+00,1.410975424683673429e+00,1.408016433738248141e+00,1.408016433738248141e+00,1.408016433738248141e+00,1.408016433738248141e+00,1.408016433738248141e+00,1.408016433738248141e+00,1.404896579213743779e+00,1.404896579213743779e+00,1.404896579213743779e+00,1.404896579213743779e+00,1.404896579213743779e+00,1.404896579213743779e+00,1.401615314131582135e+00,1.401615314131582135e+00,1.401615314131582135e+00,1.401615314131582135e+00,1.401615314131582135e+00,1.401615314131582135e+00,1.398171502084797124e+00,1.398171502084797124e+00,1.398171502084797124e+00,1.398171502084797124e+00,1.398171502084797124e+00,1.398171502084797124e+00,1.394564998637535469e+00,1.394564998637535469e+00,1.394564998637535469e+00,1.394564998637535469e+00,1.394564998637535469e+00,1.394564998637535469e+00,1.390794538153183435e+00,1.390794538153183435e+00,1.390794538153183435e+00,1.390794538153183435e+00,1.390794538153183435e+00,1.390794538153183435e+00,1.386859316209074100e+00,1.386859316209074100e+00,1.386859316209074100e+00,1.386859316209074100e+00,1.386859316209074100e+00,1.386859316209074100e+00,1.382757926110868230e+00,1.382757926110868230e+00,1.382757926110868230e+00,1.382757926110868230e+00,1.382757926110868230e+00,1.382757926110868230e+00,1.378489956798050420e+00,1.378489956798050420e+00,1.378489956798050420e+00,1.378489956798050420e+00,1.378489956798050420e+00,1.378489956798050420e+00,1.374054393823720632e+00,1.374054393823720632e+00,1.374054393823720632e+00,1.374054393823720632e+00,1.374054393823720632e+00,1.374054393823720632e+00,1.369449608712191679e+00,1.369449608712191679e+00,1.369449608712191679e+00,1.369449608712191679e+00,1.369449608712191679e+00,1.369449608712191679e+00,1.364674971440809736e+00,1.364674971440809736e+00,1.364674971440809736e+00,1.364674971440809736e+00,1.364674971440809736e+00,1.364674971440809736e+00,1.359729236182579681e+00,1.359729236182579681e+00,1.359729236182579681e+00,1.359729236182579681e+00,1.359729236182579681e+00,1.359729236182579681e+00,1.354611074396788295e+00,1.354611074396788295e+00,1.354611074396788295e+00,1.354611074396788295e+00,1.354611074396788295e+00,1.354611074396788295e+00,1.349318523968027428e+00,1.349318523968027428e+00,1.349318523968027428e+00,1.349318523968027428e+00,1.349318523968027428e+00,1.349318523968027428e+00,1.343851174133255721e+00,1.343851174133255721e+00,1.343851174133255721e+00,1.343851174133255721e+00,1.343851174133255721e+00,1.343851174133255721e+00,1.338206882423881527e+00};
//std::vector<double> data_x1dot = {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,-1.776356839400250465e-15,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,1.776356839400250465e-15,0.000000000000000000e+00};
//std::vector<double> data_x2 = {-2.147573103039898361e-08,-2.147573103039898361e-08,-2.147573103039898361e-08,-2.147573103039898361e-08,-2.147573103039898361e-08,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.325933109547863462e-03,1.325933109547863462e-03};

std::vector<double> data_x1 = {1.437279665619464630e+00,1.445010184693943822e+00,1.442280051312678335e+00,1.443163320381084302e+00,1.437620577652058529e+00,1.442776165794524612e+00,1.442512695875925344e+00,1.442649480568558795e+00,1.438790479279616230e+00,1.443075020598028280e+00,1.441321881368682334e+00,1.441320092662205399e+00,1.445300617732027337e+00,1.439005958358121395e+00,1.443200781458397142e+00,1.439264124033550862e+00,1.436709294502501288e+00,1.437446436956626661e+00,1.438065467887198690e+00,1.438534364805701404e+00,1.436120361392252409e+00,1.441435038873361663e+00,1.442262967028177023e+00,1.435865961431242344e+00,1.440456860638458236e+00,1.441757048507460670e+00,1.437185739694456954e+00,1.434771945311897445e+00,1.434406670250656379e+00,1.440074542135558744e+00,1.442757677087021628e+00,1.436561041407171890e+00,1.436205477989058510e+00,1.434026206701595640e+00,1.441329080161964482e+00,1.438697360517635415e+00,1.434740292391497141e+00,1.435232009853846025e+00,1.432684351963325220e+00,1.435378619635730546e+00,1.435666218933590921e+00,1.438702403735889757e+00,1.434666069360356122e+00,1.439058755684961666e+00,1.436243788029112123e+00,1.439538025888005057e+00,1.436285022435900727e+00,1.431154569482694372e+00,1.434579084068217991e+00,1.436430931950849921e+00,1.434571822119607987e+00,1.432624983682488917e+00,1.430723979027424209e+00,1.431811571068467348e+00,1.429801409391409317e+00,1.431777095844668279e+00,1.429895133566699394e+00,1.430121482359316465e+00,1.429710612478210852e+00,1.433053910643551365e+00,1.428688246175590981e+00,1.425454144780408328e+00,1.427534462384637326e+00,1.428021290108826724e+00,1.426449467455194631e+00,1.429864036409094430e+00,1.428218651989106025e+00,1.429582915425124501e+00,1.425162672218321491e+00,1.430233368155178653e+00,1.429701623693033330e+00,1.425160807046315758e+00,1.427510683312293471e+00,1.423414984609485012e+00,1.429123275813397376e+00,1.422122994853057154e+00,1.424758343251225634e+00,1.426872433925222339e+00,1.426554427692665605e+00,1.421964897305976638e+00,1.421884127925956198e+00,1.426406290451411429e+00,1.420431080955291803e+00,1.423403184542460842e+00,1.425001744903190648e+00,1.424287494308749791e+00,1.416912551684304189e+00,1.417170476720843508e+00,1.417932911512129746e+00,1.424165684384864017e+00,1.415616951861510042e+00,1.415744274923496082e+00,1.419367708850166165e+00,1.422326268610131894e+00,1.417170941560808251e+00,1.422200499027980181e+00,1.419618396536796556e+00,1.412506997291980815e+00,1.415041024087142940e+00,1.418951331267827687e+00,1.415242165934116558e+00,1.415293265331973860e+00,1.417418816607763477e+00,1.415514093465313650e+00,1.408220261685781960e+00,1.413075033280353443e+00,1.414056433241734467e+00,1.411386030436720729e+00,1.409206927560523237e+00,1.412272363762811844e+00,1.411722036151430437e+00,1.413393699808473292e+00,1.412706349261919403e+00,1.412688276039581137e+00,1.409921017659042874e+00,1.406069791674814384e+00,1.410637092021710837e+00,1.405492825234757381e+00,1.401988586806348858e+00,1.403460589939471648e+00,1.406605090373721278e+00,1.405030608605652320e+00,1.407437154416372405e+00,1.403023326903425350e+00,1.402513063822734107e+00,1.406005759073823302e+00,1.397472960836850797e+00,1.404028704995428978e+00,1.400059902105246890e+00,1.396113250727315958e+00,1.400295853082964115e+00,1.402397869417483456e+00,1.392250836801446789e+00,1.394893731650935331e+00,1.395705646945818224e+00,1.397408813333350652e+00,1.392643225089909675e+00,1.394292514229483304e+00,1.387762869353988071e+00,1.388134667059287786e+00,1.390389017799628313e+00,1.389853133984770173e+00,1.395812761967151205e+00,1.389071069899371569e+00,1.388708149742114317e+00,1.384901116717605740e+00,1.389106863416364801e+00,1.384015356797499985e+00,1.387794915533192119e+00,1.384305963602394218e+00,1.386013192108337622e+00,1.385953545423031175e+00,1.385661146787915632e+00,1.382829158346132070e+00,1.387388410768361169e+00,1.378999712121508958e+00,1.382152141437869020e+00,1.377844104526223967e+00,1.374643683260512450e+00,1.382514212911081009e+00,1.382719316752138772e+00,1.374220894571424934e+00,1.370059878703032918e+00,1.374318666338989026e+00,1.369529946282276311e+00,1.370648392744206134e+00,1.370923678785610056e+00,1.378598426990680137e+00,1.366513180161410768e+00,1.367109481141514982e+00,1.371116044137225876e+00,1.370317912302524199e+00,1.372023065425730382e+00,1.366727971258175023e+00,1.368378538849917669e+00,1.362608055279569186e+00,1.363835097017297437e+00,1.365967380557868260e+00,1.366415591382238226e+00,1.368697288274559609e+00,1.363297172207769359e+00,1.358437857700981688e+00,1.356876212735302234e+00,1.363146969920501661e+00,1.362524403169181220e+00,1.359632654892232395e+00,1.358334131688289759e+00,1.353216675003637182e+00,1.354966053595318298e+00,1.349878756305687988e+00,1.352913985374486705e+00,1.359024241836368052e+00,1.350913860339261197e+00,1.347255155062312193e+00,1.351064656864652935e+00,1.345433887207166057e+00,1.352818647276389452e+00,1.350627816134865489e+00,1.345278639288410405e+00};
std::vector<double> data_x1dot = {6.756458298631022596e-02,4.353975100140608512e-02,7.776056735279193721e-02,3.635378364113639720e-03,4.688585729094710275e-02,7.737960186429369835e-02,2.925343323701803597e-02,8.050463590295980909e-02,2.890996460156650821e-02,4.699283656916674462e-02,1.096491396762221474e-02,5.683424841885530848e-02,5.515364164098851552e-02,3.683644098050453675e-02,9.501762965429699781e-02,7.538749885079348845e-02,7.704766257326885193e-02,9.146621292772483952e-03,7.574945157379976701e-02,5.598544932864844142e-02,8.023579576539553726e-02,3.317509731968158043e-02,9.924753465032803978e-02,7.492691367331727643e-03,7.731219755156029660e-02,4.982786649165013571e-02,2.625565484929989410e-02,9.394849140060014536e-02,5.673335318314477738e-02,4.918938019784702131e-02,7.329247974633888718e-02,3.126565700555366395e-02,3.453296248981896528e-03,4.333281763098550260e-02,5.535675374285752709e-02,6.663179479172619268e-02,4.125830080833791519e-02,8.590473365157991897e-03,5.690341703528542516e-02,1.720433135664619848e-02,4.566051697773616802e-02,1.755972542786346166e-02,7.548872890904488597e-02,3.282537041572974185e-02,9.191980811630308390e-02,7.946585791909367702e-02,4.597537888711156380e-03,5.248585254232136788e-02,5.173436434047606891e-03,1.125108201506771523e-02,5.051118312669600555e-03,5.597031845827957902e-02,9.366684359982124786e-02,2.642089207466949072e-02,8.301128021936245160e-02,7.544419704418166284e-02,7.818318294762049980e-02,8.454950380333493137e-03,5.342399098222575665e-02,3.839841705550742224e-02,2.200296950872237048e-02,1.283774095512628735e-02,6.792656162766919081e-03,6.709957676107013158e-02,7.574939595255517077e-02,6.837262302949685677e-02,8.084849772644091270e-02,9.688925988899951824e-02,8.164815012418026596e-02,5.552471579043260358e-02,8.111181323166696822e-02,6.972383249165726993e-02,5.662031805757205410e-02,1.522420587057322743e-02,9.774760990264196037e-02,4.314852282749115885e-03,3.802502164432933901e-02,5.507746098096221593e-02,1.726861393158967209e-02,4.875700380605440393e-02,7.859797566552571835e-02,1.969045393326721710e-02,3.206045356031250737e-02,2.824884182098507182e-02,9.246045961370220889e-02,2.037767443936399150e-02,4.720769723617921493e-02,7.431069511874892342e-02,7.819579569977419542e-03,9.392296597045503292e-02,4.434408188428681785e-02,9.076773127240971017e-02,5.981311206554756205e-02,6.550306041114192790e-02,3.637019004396614685e-02,7.955141974859901433e-02,8.899451707370242826e-02,1.693352520288102930e-02,8.183965261167181274e-03,7.516980177328887180e-02,5.259949071926881686e-02,9.206495610690609843e-02,9.801049262409708418e-02,7.865507347712097364e-02,5.251169343670991640e-02,6.079102267188954412e-02,3.584334666547457637e-02,7.243125843636964711e-02,2.996004501693463537e-02,2.140560900976881328e-02,2.151744762175017422e-02,8.933486479816728221e-02,1.054914012390247881e-02,2.010999268405349108e-02,4.743103804543086222e-02,1.785637764244955156e-02,7.797483511843257553e-02,2.338262237757459186e-02,8.837902904587108255e-02,4.880796485821731201e-02,8.937287603224419730e-02,7.586743154106029285e-02,1.940355619239223645e-02,9.146571077561720109e-02,5.291057468044513268e-02,1.950547876916453038e-02,7.716737144153865136e-02,9.398715242308210149e-03,1.468927040295620046e-02,6.495384213666299811e-02,1.096387118907014152e-02,1.878124618593170203e-02,8.135304150171097926e-02,9.848152001804150180e-02,5.247727233756763893e-02,1.835391396639511966e-02,9.445991517673325844e-02,9.774123341244631002e-02,6.042584624582503228e-02,1.876086664655377684e-02,7.569632177085919289e-02,7.933879993308944056e-02,4.158125814978212015e-02,7.927044168536724611e-02,2.588775293298820751e-02,5.061869953967643859e-02,7.843582837318718859e-02,5.977291932214509607e-02,8.711361539374572194e-02,4.962621998190998307e-02,6.802672813935735363e-02,3.227118907267726572e-02,9.202879091192762290e-03,9.621403150889940026e-03,2.170839453881096004e-02,4.995180261031344909e-02,1.651767531820279647e-02,4.570087353438415101e-02,8.890404240187232965e-02,1.541343163396442610e-02,3.303991662201079260e-02,5.698629336771172949e-02,2.315951947154236759e-02,1.643225107082222497e-02,4.336147493719500444e-03,1.212396245621623174e-02,3.410431656316913890e-02,9.902044754067601540e-02,6.834214587503118117e-03,9.745949923485358601e-02,5.291597345399447205e-02,2.463594361038931244e-02,8.249010328052625018e-02,5.821069893142883332e-03,1.737891556486807071e-02,9.347887544551691796e-02,6.920542326430610680e-02,6.605407080567005096e-02,4.450192303995318538e-02,5.604816518703859690e-03,1.455641124317075437e-03,6.586270267233838849e-02,9.751298220924698931e-03,7.112333791843429565e-02,8.617875680062447863e-02,2.070897943965547411e-02,8.567608663336939712e-02,5.596076128891853962e-02,4.356188454119364062e-02,9.117075074034852733e-02,9.735531671998742809e-02,7.629835126533805745e-02,5.115917300869491507e-02,4.200109797749296270e-02,1.757787755642092886e-02,2.090177630906502396e-02,2.822896906547257834e-02,1.851590180750232323e-02,3.132284259276756772e-02};
std::vector<double> data_x2 = {-2.147573103039898361e-08,-2.147573103039898361e-08,-2.147573103039898361e-08,-2.147573103039898361e-08,-2.147573103039898361e-08,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,6.206486267785306317e-06,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,1.458917994665104382e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,2.512660530556681517e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,3.781160376752248339e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,5.264417533251804850e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,6.962432000055351726e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,8.875203777162887612e-05,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.100201700687340051e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.334287168918688905e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.589776782410335461e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,1.866598955392178313e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.164682102094116331e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.484026222516149242e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,2.824631316658277047e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.186425798750398613e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.569338083022412537e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,3.973368169474318819e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.398444472336016054e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,4.844495405837402841e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.311520969978479178e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,5.799377993219042259e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.308066475559093167e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,6.837514831228529415e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.387723060227351004e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,7.958547991015356210e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,8.549918037822442545e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.161833200648611094e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,9.794150307953657965e-04,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.044679777396748284e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.111970401291998431e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.181286902481116239e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.252607805233071176e-03,1.325933109547863462e-03,1.325933109547863462e-03};



double m = 9.740900721536853;
double g = 9.81;
double rho_e = 1025.0;
double C = 0.09503317777109124;
double V = 0.00664;

struct FlotteurResidual {
  FlotteurResidual(double x1dot, double x1, double x2)
      : x1dot_(x1dot), x1_(x1), x2_(x2) {}
  template <typename T> bool operator()(const T* const beta,
                                        T* residual) const {
    residual[0] = g-(g*(V+x2_+beta[0])-0.5*C*x1_*abs(x1_))*rho_e/m-x1dot_;
    return true;
  }
 private:
  const double x1dot_;
  const double x1_;
  const double x2_;
};

int main(int argc, char** argv) {
  google::InitGoogleLogging(argv[0]);
  double beta = -0.01;

  Problem problem;
  for (int i = 0; i < kNumObservations; ++i) {
    problem.AddResidualBlock(
        new AutoDiffCostFunction<FlotteurResidual, 1, 1>(
            new FlotteurResidual(data_x1dot[i], data_x1[i], data_x2[i])),
        NULL,
        &beta);
  }
  Solver::Options options;
  options.max_num_iterations = 25;
  options.linear_solver_type = ceres::DENSE_QR;
  options.minimizer_progress_to_stdout = true;
  Solver::Summary summary;
  Solve(options, &problem, &summary);
  std::cout << summary.FullReport() << "\n";
  std::cout << "Initial beta: " << 0.0 << std::endl;
  std::cout << "Final   beta: " << beta << std::endl;
  return 0;
}
